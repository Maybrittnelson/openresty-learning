events{}

http {
  fastcgi_cache_path /tmp/php_cache levels=1:2 keys_zone=cache_php:30m inactive=5s max_size=10g;
  server {
    location / {
      root /tmp/php;
      fastcgi_pass 127.0.0.1:9000;
      include http-fastcgi-module/fastcgi_params;
      fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
      
      fastcgi_temp_path /tmp/fastcgi/temp;
      fastcgi_cache   cache_php;
      fastcgi_cache_valid   200 302  5h;
      fastcgi_cache_key $uri;

      # 使用fastcgi_catch_stderr也没能让invalid_header工作起来
      # 不过貌似返回iude错误不一样
      # 如果没有fastcgi_catch_stderr "error"， 那么直接返回500 internal error
      # 存在该指令以后， 返回502 Bad Gateway
      # fastcgi_catch_stderr "error";
      fastcgi_cache_use_stale error timeout invalid_header;
    }
  }
}
