#
# server-rewrite --> rewrite
#   1. 当 ngx_rewrite 模块的配置指令直接书写在 server 配置块中时，基本上都是运行在 server-rewrite 阶段

events{}

http {
    server {
        location / {
            set $b "$a world";
            echo $b;
        }
        set $a "hello";
    }

    #
    # 证明在post-read之后的方法
    # curl -H "X-Real-IP: 12.2.2.2" localhost:8080
    #
    server {
        listen 8080;
        set $addr $remote_addr;
        set_real_ip_from 127.0.0.1;
        real_ip_header   X-Real-IP;
        location / {
            echo "from: $addr";
        }
    }
}
